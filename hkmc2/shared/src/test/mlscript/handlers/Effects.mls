:js

abstract class Effect with
  fun perform(arg: Str): Str

:ge
handle h = Effect with
  fun perform(arg, k) = k(arg)
in
  h.perform("k")
//│ ╔══[COMPILATION ERROR] Effect handlers are not enabled
//│ ║  l.7: 	handle h = Effect with
//│ ║       	           ^^^^^^^^^^^
//│ ║  l.8: 	  fun perform(arg, k) = k(arg)
//│ ╙──     	^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ═══[RUNTIME ERROR] TypeError: Cannot read properties of null (reading 'perform')

:global
:handler

:expect 'b'
handle h = Effect with
  fun perform(arg, k) = "b"
in
  h.perform("k")
//│ = 'b'

:expect 'k'
handle h = Effect with
  fun perform(arg, k) = arg
in
  h.perform("k")
//│ = 'k'

:fixme
handle h = Effect with
  fun perform(arg, k) = k(arg)
in
  h.perform("k")
//│ ═══[RUNTIME ERROR] Error: Resume not implemented
