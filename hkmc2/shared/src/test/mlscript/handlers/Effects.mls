:js

abstract class Effect with
  fun perform(arg: Str): Str

:ge
let r = handle h = Effect with
  fun perform(arg, k) = k(arg)
in
  h.perform("k")
r
//│ ╔══[COMPILATION ERROR] Effect handlers are not enabled
//│ ║  l.7: 	let r = handle h = Effect with
//│ ║       	                   ^^^^^^^^^^^
//│ ║  l.8: 	  fun perform(arg, k) = k(arg)
//│ ╙──     	^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ═══[RUNTIME ERROR] TypeError: Cannot read properties of null (reading 'perform')

:global
:handler

:fixme
let r = handle h = Effect with
  fun perform(arg, k) = k(arg)
in
  h.perform("k")
r
//│ /!!!\ Uncaught error: scala.MatchError: HandleBlock(globalThis:block#3.h,$tmp,Select(Ref(globalThis:block#1),Ident(Effect)),List(Handler(member:perform,k,List(ParamList(‹›,List(Param(‹›,arg,None)),None)),Return(Call(Ref(k),List(Arg(false,Ref(arg)))),false))),HandleBlockReturn(Call(Select(Ref(globalThis:block#3.h),Ident(perform)),List(Arg(false,Lit(StrLit(k)))))),Assign(globalThis:block#3.r,Ref($tmp),Return(Ref(globalThis:block#3.r),true))) (of class hkmc2.codegen.HandleBlock)
