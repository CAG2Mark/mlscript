:global
:bbml


fun add: (Int, Int) -> Int
fun add(x, y) = x + y
//│ Elab: { fun add: (class:Int#15, class:Int#16)‹› -> class:Int#17‹›; fun add(x@2, y@3): (class:Int#18, class:Int#19)‹› -> class:Int#20‹› = +#0(x@2#0, y@3#0)‹›‹›; }‹›
//│ Type: ⊤

:e
fun foo: Int -> Int
fun foo: Int -> Int
//│ ╔══[ERROR] Duplicate definition of foo
//│ ╙── aready defined here
//│ Elab: { fun foo: (class:Int#21)‹› -> class:Int#22‹›; fun foo: (class:Int#23)‹› -> class:Int#24‹›; }‹›
//│ Type: ⊤

:e
fun id(x) = x
fun id(y) = y
//│ ╔══[ERROR] Duplicate definition of id
//│ ║  l.20: 	fun id(y) = y
//│ ║        	      ^^^
//│ ╙── aready defined here
//│ Elab: { fun id(x@1) = x@1#0; fun id(y@3) = y@3#0; }‹›
//│ Type: ⊤

:e
fun bar: Str -> Str
fun bar(x) = let t = x + 1 in "aaa"
//│ Elab: { fun bar: (class:Str#0)‹› -> class:Str#1‹›; fun bar(x@2): (class:Str#2)‹› -> class:Str#3‹› = { let t@3 = +#1(x@2#0, 1‹›)‹›‹›; "aaa"‹› }‹›; }‹›
//│ ╔══[ERROR] Cannot solve Str ∧ ¬⊥
//│ ╙──
//│ Type: ⊤

:e
fun baz: Int -> Int
fun baz(x) = "bbb"
//│ Elab: { fun baz: (class:Int#25)‹› -> class:Int#26‹›; fun baz(x@2): (class:Int#27)‹› -> class:Int#28‹› = "bbb"‹›; }‹›
//│ ╔══[ERROR] Cannot solve Str ∧ ¬⊥
//│ ╙──
//│ Type: ⊤

add(1, 2)
//│ Elab: { add#0(1‹›, 2‹›)‹›‹› }‹›
//│ Type: Int

add(1, 2): Int
//│ Elab: { App(Ref(add),Tup(List(Fld(‹›,Lit(IntLit(1)),None), Fld(‹›,Lit(IntLit(2)),None)))): Ref(class:Int)‹› }‹›
//│ Type: Int


:e
add(0, 0): Str
//│ Elab: { App(Ref(add),Tup(List(Fld(‹›,Lit(IntLit(0)),None), Fld(‹›,Lit(IntLit(0)),None)))): Ref(class:Str)‹› }‹›
//│ ╔══[ERROR] Cannot solve Int ∧ ¬⊥
//│ ╙──
//│ Type: Str

:e
fun errAdd(x: Int) = x + "1"
//│ Elab: { fun errAdd(x@1: class:Int#30) = +#2(x@1#0, "1"‹›)‹›‹›; }‹›
//│ ╔══[ERROR] Cannot solve Str ∧ ¬⊥
//│ ╙──
//│ Type: ⊤

fun high(f: [A] -> A -> A) = f(42)
//│ Elab: { fun high(f@1: forall A@2: FunTy(Tup(List(Fld(‹›,Ref(A@2),None))),Ref(A@2))‹›) = f@1#0(42‹›)‹›‹›; }‹›
//│ Type: ⊤

high
//│ Elab: { high#0 }‹›
//│ Type: (forall α2_1: (α2_1) ->{⊥} α2_1) ->{⊥} α4_0
//│ Where:
//│   ⊤ ∧ ¬⊥ ∧ α5_0 <: α4_0
//│   Int ∧ ¬⊥ <: α5_0

:e
high(x => x + 1)
//│ Elab: { high#1(λx@2. +#3(x@2#0, 1‹›)‹›‹›‹›)‹›‹› }‹›
//│ ╔══[ERROR] Cannot solve ⊤ ∧ ¬⊥
//│ ╙──
//│ ╔══[ERROR] Cannot constrain skolem α2_1
//│ ╙──
//│ Type: α4_0
//│ Where:
//│   ⊤ ∧ ¬⊥ ∧ α5_0 <: α4_0
//│   Int ∧ ¬⊥ <: α5_0
